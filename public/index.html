<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tester MinIO Server</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; }
    h1 { color: #333; }
    .preview { margin: 15px 0; }
    img { max-width: 100%; margin-top: 10px; border: 1px solid #ccc; }
    .post { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>App Tester - MinIO Server</h1>

  <!-- Upload -->
  <h2>Subir imagen</h2>
  <form id="uploadForm">
    <input type="file" name="image" accept="image/*" required />
    <button type="submit">Subir</button>
  </form>
  <div class="preview" id="uploadResult"></div>

  <!-- Posts -->
  <h2>Publicaciones guardadas</h2>
  <button id="loadPosts">Cargar posts</button>
  <div id="posts"></div>

  <script>
    const API_URL = "http://localhost:3000"; // ⚠️ ajusta a la IP/puerto de tu server

    // --- Upload handler ---
    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);

      try {
        const res = await fetch(`${API_URL}/upload`, {
          method: "POST",
          body: formData
        });

        if (!res.ok) throw new Error("Error al subir la imagen");

        const data = await res.json();
        document.getElementById("uploadResult").innerHTML = `
          ✅ Imagen subida: <a href="${data.image_url}" target="_blank">${data.image_url}</a>
          <br/>
          <img src="${data.image_url}" alt="Preview" />
        `;
      } catch (err) {
        document.getElementById("uploadResult").innerText = "❌ " + err.message;
      }
    });

    // --- Load posts handler ---
    document.getElementById("loadPosts").addEventListener("click", async () => {
      try {
        const res = await fetch(`${API_URL}/posts`);
        if (!res.ok) throw new Error("Error al cargar posts");

        const posts = await res.json();
        const container = document.getElementById("posts");
        container.innerHTML = posts.map(p => `
          <div class="post">
            <p><b>ID:</b> ${p.id}</p>
            <p><b>Likes:</b> ${p.likes}</p>
            <img src="${p.image_url}" alt="Post image"/>
          </div>
        `).join("");
      } catch (err) {
        document.getElementById("posts").innerText = "❌ " + err.message;
      }
    });
  </script>
</body>
</html>
